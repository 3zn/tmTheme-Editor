<span class='l l-1 source r'><s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>geom_dotplot</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s> (<s class='variable parameter r' data-entity-scope='variable.parameter.r'>mapping</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>data</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stat</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>bindot<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>position</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>identity<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>,
</span><span class='l l-2 source r'><s class='variable parameter r' data-entity-scope='variable.parameter.r'>na.rm</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>FALSE</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binwidth</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binaxis</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>x<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>method</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>dotdensity<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binpositions</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>bygroup<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>up<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>,
</span><span class='l l-3 source r'><s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackratio</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>dotsize</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackgroups</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>FALSE</s>, <s class='keyword other r' data-entity-scope='keyword.other.r'>...</s>) {
</span><span class='l l-4 source r'>  <s class='variable other r' data-entity-scope='variable.other.r'>GeomDotplot</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s>new(<s class='variable parameter r' data-entity-scope='variable.parameter.r'>mapping</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>mapping</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>data</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>data</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stat</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stat</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>position</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>position</s>,
</span><span class='l l-5 source r'>  <s class='variable parameter r' data-entity-scope='variable.parameter.r'>na.rm</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>na.rm</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binwidth</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>binwidth</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binaxis</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>method</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>method</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binpositions</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>binpositions</s>,
</span><span class='l l-6 source r'>  <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackratio</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackratio</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>dotsize</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>dotsize</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stackgroups</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackgroups</s>, <s class='keyword other r' data-entity-scope='keyword.other.r'>...</s>)
</span><span class='l l-7 source r'>}
</span><span class='l l-8 source r'>
</span><span class='l l-9 source r'><s class='variable other r' data-entity-scope='variable.other.r'>GeomDotplot</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> proto(<s class='variable other r' data-entity-scope='variable.other.r'>Geom</s>, {
</span><span class='l l-10 source r'>  <s class='variable other r' data-entity-scope='variable.other.r'>objname</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>dotplot<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>
</span><span class='l l-11 source r'>
</span><span class='l l-12 source r'>  <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>new</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(., <s class='variable parameter r' data-entity-scope='variable.parameter.r'>mapping</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>data</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stat</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>position</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant language r' data-entity-scope='constant.language.r'>NULL</s>, <s class='keyword other r' data-entity-scope='keyword.other.r'>...</s>){
</span><span class='l l-13 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> This code is adapted from Layer$new. It&#39;s needed to pull out the stat_params
</s></span><span class='l l-14 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> and geom_params, then manually add binaxis to both sets of params. Otherwise
</s></span><span class='l l-15 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Layer$new will give binaxis only to the geom.
</s></span><span class='l l-16 source r'>
</span><span class='l l-17 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>stat</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>Stat</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s>find(<s class='variable other r' data-entity-scope='variable.other.r'>stat</s>)
</span><span class='l l-18 source r'>    <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>match.params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(<s class='variable other r' data-entity-scope='variable.other.r'>possible</s>, <s class='variable other r' data-entity-scope='variable.other.r'>params</s>) {
</span><span class='l l-19 source r'>      <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>...<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>%in%</s> names(<s class='variable other r' data-entity-scope='variable.other.r'>possible</s>)) {
</span><span class='l l-20 source r'>        <s class='variable other r' data-entity-scope='variable.other.r'>params</s>
</span><span class='l l-21 source r'>      } <s class='keyword control r' data-entity-scope='keyword.control.r'>else</s> {
</span><span class='l l-22 source r'>        <s class='variable other r' data-entity-scope='variable.other.r'>params</s>[match(names(<s class='variable other r' data-entity-scope='variable.other.r'>possible</s>), names(<s class='variable other r' data-entity-scope='variable.other.r'>params</s>), <s class='variable parameter r' data-entity-scope='variable.parameter.r'>nomatch</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>0</s>)]
</span><span class='l l-23 source r'>      }
</span><span class='l l-24 source r'>    }
</span><span class='l l-25 source r'>
</span><span class='l l-26 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='storage type r' data-entity-scope='storage.type.r'>list</s>(<s class='keyword other r' data-entity-scope='keyword.other.r'>...</s>)
</span><span class='l l-27 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> American names must be changed here so that they&#39;ll go to geom_params;
</s></span><span class='l l-28 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> otherwise they&#39;ll end up in stat_params
</s></span><span class='l l-29 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> rename_aes(<s class='variable other r' data-entity-scope='variable.other.r'>params</s>)
</span><span class='l l-30 source r'>
</span><span class='l l-31 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>geom_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> match.params(.<s class='keyword other r' data-entity-scope='keyword.other.r'>$</s>parameters(), <s class='variable other r' data-entity-scope='variable.other.r'>params</s>)
</span><span class='l l-32 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> match.params(<s class='variable other r' data-entity-scope='variable.other.r'>stat</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s>parameters(), <s class='variable other r' data-entity-scope='variable.other.r'>params</s>)
</span><span class='l l-33 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s>[setdiff(names(<s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s>), names(<s class='variable other r' data-entity-scope='variable.other.r'>geom_params</s>))]
</span><span class='l l-34 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Add back binaxis
</s></span><span class='l l-35 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> c(<s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>binaxis</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s>)
</span><span class='l l-36 source r'>
</span><span class='l l-37 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> If identical(position, &quot;stack&quot;) or position is position_stack() (the test
</s></span><span class='l l-38 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s>  is kind of complex), tell them to use stackgroups=TRUE instead. Need to
</s></span><span class='l l-39 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s>  use identical() instead of ==, because == will fail if object is
</s></span><span class='l l-40 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s>  position_stack() or position_dodge()
</s></span><span class='l l-41 source r'>    <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>!</s>is.null(<s class='variable other r' data-entity-scope='variable.other.r'>position</s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>&amp;&amp;</s> (identical(<s class='variable other r' data-entity-scope='variable.other.r'>position</s>, <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>stack<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s> (is.proto(<s class='variable other r' data-entity-scope='variable.other.r'>position</s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>&amp;&amp;</s> <s class='variable other r' data-entity-scope='variable.other.r'>position</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>objname</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>stack<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>)))
</span><span class='l l-42 source r'>      message(<s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>position=<s class='constant character escape r' data-entity-scope='constant.character.escape.r'>\&quot;</s>stack<s class='constant character escape r' data-entity-scope='constant.character.escape.r'>\&quot;</s> doesn&#39;t work properly with geom_dotplot. Use stackgroups=TRUE instead.<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>)
</span><span class='l l-43 source r'>
</span><span class='l l-44 source r'>    <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackgroups</s> <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>&amp;&amp;</s> <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>method</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>dotdensity<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s> <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>&amp;&amp;</s> <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binpositions</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>bygroup<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>)
</span><span class='l l-45 source r'>      message(<s class='string quoted single r' data-entity-scope='string.quoted.single.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&#39;</s>geom_dotplot called with stackgroups=TRUE and method=&quot;dotdensity&quot;. You probably want to set binpositions=&quot;all&quot;<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&#39;</s></s>)
</span><span class='l l-46 source r'>
</span><span class='l l-47 source r'>    do.call(<s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>layer<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>, <s class='storage type r' data-entity-scope='storage.type.r'>list</s>(<s class='variable parameter r' data-entity-scope='variable.parameter.r'>mapping</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>mapping</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>data</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>data</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stat</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stat</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>geom</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> ., <s class='variable parameter r' data-entity-scope='variable.parameter.r'>position</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>position</s>,
</span><span class='l l-48 source r'>                          <s class='variable parameter r' data-entity-scope='variable.parameter.r'>geom_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>geom_params</s>, <s class='variable parameter r' data-entity-scope='variable.parameter.r'>stat_params</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='variable other r' data-entity-scope='variable.other.r'>stat_params</s>, <s class='keyword other r' data-entity-scope='keyword.other.r'>...</s>))
</span><span class='l l-49 source r'>  }
</span><span class='l l-50 source r'>
</span><span class='l l-51 source r'>
</span><span class='l l-52 source r'>  <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>reparameterise</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(., <s class='variable other r' data-entity-scope='variable.other.r'>df</s>, <s class='variable other r' data-entity-scope='variable.other.r'>params</s>) {
</span><span class='l l-53 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>width</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>width</s> %<s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s>%
</span><span class='l l-54 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>width</s> %<s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s>% (resolution(<s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>x</s>, <s class='constant language r' data-entity-scope='constant.language.r'>FALSE</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>*</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>0.9</s>)
</span><span class='l l-55 source r'>
</span><span class='l l-56 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Set up the stacking function and range
</s></span><span class='l l-57 source r'>    <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s>(is.null(<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s> <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>up<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-58 source r'>      <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>stackdots</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(<s class='variable other r' data-entity-scope='variable.other.r'>a</s>)  <s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> .<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-59 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>0</s>
</span><span class='l l-60 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>
</span><span class='l l-61 source r'>    } <s class='keyword control r' data-entity-scope='keyword.control.r'>else</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>down<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-62 source r'>      <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>stackdots</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(<s class='variable other r' data-entity-scope='variable.other.r'>a</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s><s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>+</s> .<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-63 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s><s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>
</span><span class='l l-64 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>0</s>
</span><span class='l l-65 source r'>    } <s class='keyword control r' data-entity-scope='keyword.control.r'>else</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>center<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-66 source r'>      <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>stackdots</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(<s class='variable other r' data-entity-scope='variable.other.r'>a</s>)  <s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> max(<s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>
</span><span class='l l-67 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s>.<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-68 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> .<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-69 source r'>    } <s class='keyword control r' data-entity-scope='keyword.control.r'>else</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackdir</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>centerwhole<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-70 source r'>      <s class='meta function r' data-entity-scope='meta.function.r'><s class='entity name function r' data-entity-scope='entity.name.function.r'>stackdots</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s></s>(<s class='variable other r' data-entity-scope='variable.other.r'>a</s>)  <s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> floor(max(<s class='variable other r' data-entity-scope='variable.other.r'>a</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>)
</span><span class='l l-71 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s>.<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-72 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> .<s class='constant numeric r' data-entity-scope='constant.numeric.r'>5</s>
</span><span class='l l-73 source r'>    }
</span><span class='l l-74 source r'>
</span><span class='l l-75 source r'>
</span><span class='l l-76 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Fill the bins: at a given x (or y), if count=3, make 3 entries at that x
</s></span><span class='l l-77 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>df</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s>[rep(<s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s><s class='keyword other r' data-entity-scope='keyword.other.r'>:</s>nrow(<s class='variable other r' data-entity-scope='variable.other.r'>df</s>), <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>count</s>), ]
</span><span class='l l-78 source r'>
</span><span class='l l-79 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Next part will set the position of each dot within each stack
</s></span><span class='l l-80 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> If stackgroups=TRUE, split only on x (or y) and panel; if not stacking, also split by group
</s></span><span class='l l-81 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s> %<s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s>% <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>x<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>
</span><span class='l l-82 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> c(<s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s>, <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>PANEL<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>)
</span><span class='l l-83 source r'>    <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (is.null(<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackgroups</s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s> <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>!</s><s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackgroups</s>)
</span><span class='l l-84 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> c(<s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s>, <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>group<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>)
</span><span class='l l-85 source r'>
</span><span class='l l-86 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Within each x, or x+group, set countidx=1,2,3, and set stackpos according to stack function
</s></span><span class='l l-87 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>df</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> ddply(<s class='variable other r' data-entity-scope='variable.other.r'>df</s>, <s class='variable other r' data-entity-scope='variable.other.r'>plyvars</s>, <s class='keyword control r' data-entity-scope='keyword.control.r'>function</s>(<s class='variable other r' data-entity-scope='variable.other.r'>xx</s>) {
</span><span class='l l-88 source r'>            <s class='variable other r' data-entity-scope='variable.other.r'>xx</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>countidx</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s><s class='keyword other r' data-entity-scope='keyword.other.r'>:</s>nrow(<s class='variable other r' data-entity-scope='variable.other.r'>xx</s>)
</span><span class='l l-89 source r'>            <s class='variable other r' data-entity-scope='variable.other.r'>xx</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>stackpos</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> stackdots(<s class='variable other r' data-entity-scope='variable.other.r'>xx</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>countidx</s>)
</span><span class='l l-90 source r'>            <s class='variable other r' data-entity-scope='variable.other.r'>xx</s>
</span><span class='l l-91 source r'>          })
</span><span class='l l-92 source r'>
</span><span class='l l-93 source r'>
</span><span class='l l-94 source r'>    <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Set the bounding boxes for the dots
</s></span><span class='l l-95 source r'>    <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (is.null(<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s>) <s class='keyword operator logical r' data-entity-scope='keyword.operator.logical.r'>||</s> <s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>x<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-96 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> ymin, ymax, xmin, and xmax define the bounding rectangle for each stack
</s></span><span class='l l-97 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Can&#39;t do bounding box per dot, because y position isn&#39;t real.
</s></span><span class='l l-98 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> After position code is rewritten, each dot should have its own bounding box.
</s></span><span class='l l-99 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>xmin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>x</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binwidth</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>
</span><span class='l l-100 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>xmax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>x</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>+</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binwidth</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>
</span><span class='l l-101 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>ymin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s>
</span><span class='l l-102 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>ymax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s>
</span><span class='l l-103 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>y</s>    <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>0</s>
</span><span class='l l-104 source r'>
</span><span class='l l-105 source r'>    } <s class='keyword control r' data-entity-scope='keyword.control.r'>else</s> <s class='keyword control r' data-entity-scope='keyword.control.r'>if</s> (<s class='variable other r' data-entity-scope='variable.other.r'>params</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>binaxis</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s><s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> <s class='string quoted double r' data-entity-scope='string.quoted.double.r'><s class='punctuation definition string begin r' data-entity-scope='punctuation.definition.string.begin.r'>&quot;</s>y<s class='punctuation definition string end r' data-entity-scope='punctuation.definition.string.end.r'>&quot;</s></s>) {
</span><span class='l l-106 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> ymin, ymax, xmin, and xmax define the bounding rectangle for each stack
</s></span><span class='l l-107 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Can&#39;t do bounding box per dot, because x position isn&#39;t real.
</s></span><span class='l l-108 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> xmin and xmax aren&#39;t really the x bounds, because of the odd way the grob
</s></span><span class='l l-109 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> works. They&#39;re just set to the standard x +- width/2 so that dot clusters
</s></span><span class='l l-110 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> can be dodged like other geoms.
</s></span><span class='l l-111 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> After position code is rewritten, each dot should have its own bounding box.
</s></span><span class='l l-112 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> ddply(<s class='variable other r' data-entity-scope='variable.other.r'>df</s>, .(<s class='variable other r' data-entity-scope='variable.other.r'>group</s>), <s class='variable other r' data-entity-scope='variable.other.r'>transform</s>,
</span><span class='l l-113 source r'>            <s class='variable parameter r' data-entity-scope='variable.parameter.r'>ymin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> min(<s class='variable other r' data-entity-scope='variable.other.r'>y</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>-</s> <s class='variable other r' data-entity-scope='variable.other.r'>binwidth</s>[<s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>] <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>,
</span><span class='l l-114 source r'>            <s class='variable parameter r' data-entity-scope='variable.parameter.r'>ymax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>=</s> max(<s class='variable other r' data-entity-scope='variable.other.r'>y</s>) <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>+</s> <s class='variable other r' data-entity-scope='variable.other.r'>binwidth</s>[<s class='constant numeric r' data-entity-scope='constant.numeric.r'>1</s>] <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>/</s> <s class='constant numeric r' data-entity-scope='constant.numeric.r'>2</s>)
</span><span class='l l-115 source r'>
</span><span class='l l-116 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>xmin</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>x</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>+</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>width</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>*</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismin</s>
</span><span class='l l-117 source r'>      <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>xmax</s> <s class='keyword operator assignment r' data-entity-scope='keyword.operator.assignment.r'>&lt;-</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>x</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>+</s> <s class='variable other r' data-entity-scope='variable.other.r'>df</s><s class='keyword other r' data-entity-scope='keyword.other.r'>$</s><s class='variable other r' data-entity-scope='variable.other.r'>width</s> <s class='keyword operator arithmetic r' data-entity-scope='keyword.operator.arithmetic.r'>*</s> <s class='variable other r' data-entity-scope='variable.other.r'>stackaxismax</s>
</span><span class='l l-118 source r'>      <s class='comment line number-sign r' data-entity-scope='comment.line.number-sign.r'><s class='punctuation definition comment r' data-entity-scope='punctuation.definition.comment.r'>#</s> Unlike with y above, don&#39;t change x because it will cause problems with dodging
</s></span><span class='l l-119 source r'>    }
</span><span class='l l-120 source r'>    <s class='variable other r' data-entity-scope='variable.other.r'>df</s>
</span><span class='l l-121 source r'>  }</span>

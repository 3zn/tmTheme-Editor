<span class='l l-1 source python'><s class='comment line number-sign python'><s class='punctuation definition comment python'>#</s>!/usr/bin/python
</s></span><span class='l l-2 source python'><s class='comment line number-sign python'><s class='punctuation definition comment python'>#</s> -*- coding: utf-8 -*-
</s></span><span class='l l-3 source python'>
</span><span class='l l-4 source python'><s class='keyword control import python'>import</s> re
</span><span class='l l-5 source python'><s class='keyword control import python'>import</s> sublime
</span><span class='l l-6 source python'><s class='keyword control import python'>import</s> sublime_plugin
</span><span class='l l-7 source python'><s class='keyword control import from python'>from</s> datetime <s class='keyword control import python'>import</s> datetime
</span><span class='l l-8 source python'>
</span><span class='l l-9 source python'>
</span><span class='l l-10 source python'><s class='meta class python'><s class='storage type class python'>class</s> <s class='entity name type class python'>SublimeTasksBase</s><s class='punctuation definition inheritance begin python'>(</s><s class='meta class inheritance python'><s class='entity other inherited-class python'>sublime_plugin.TextCommand</s></s><s class='punctuation definition inheritance end python'>)</s><s class='punctuation section class begin python'>:</s></s>
</span><span class='l l-11 source python'><s class='meta function python'>    <s class='storage type function python'>def</s> <s class='entity name function python'>run</s><s class='punctuation definition parameters begin python'>(</s><s class='meta function parameters python'><s class='variable parameter function python'>self</s><s class='punctuation separator parameters python'>,</s> <s class='variable parameter function python'>edit</s></s><s class='punctuation definition parameters end python'>)</s><s class='punctuation section function begin python'>:</s></s>
</span><span class='l l-12 source python'>        <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.settings<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>get<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>open_tasks_bullet<s class='punctuation definition string end python'>'</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-13 source python'>        <s class='variable language python'>self</s>.done_tasks_bullet <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.settings<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>get<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>done_tasks_bullet<s class='punctuation definition string end python'>'</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-14 source python'>        <s class='variable language python'>self</s>.date_format <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.settings<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>get<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>date_format<s class='punctuation definition string end python'>'</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-15 source python'>        <s class='keyword control flow python'>if</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.settings<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>get<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>done_tag<s class='punctuation definition string end python'>'</s></s></s><s class='punctuation definition arguments end python'>)</s></s>:
</span><span class='l l-16 source python'>            <s class='variable language python'>self</s>.done_tag <s class='keyword operator assignment python'>=</s> <s class='string quoted double single-line python'><s class='punctuation definition string begin python'>"</s>@done<s class='punctuation definition string end python'>"</s></s>
</span><span class='l l-17 source python'>        <s class='keyword control flow python'>else</s>:
</span><span class='l l-18 source python'>            <s class='variable language python'>self</s>.done_tag <s class='keyword operator assignment python'>=</s> <s class='string quoted double single-line python'><s class='punctuation definition string begin python'>"</s><s class='punctuation definition string end python'><s class='meta empty-string double python'>"</s></s></s>
</span><span class='l l-19 source python'>        <s class='meta function-call python'><s class='variable language python'>self</s>.runCommand<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>edit</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-20 source python'>
</span><span class='l l-21 source python'>
</span><span class='l l-22 source python'><s class='meta class python'><s class='storage type class python'>class</s> <s class='entity name type class python'>NewCommand</s><s class='punctuation definition inheritance begin python'>(</s><s class='meta class inheritance python'><s class='entity other inherited-class python'>SublimeTasksBase</s></s><s class='punctuation definition inheritance end python'>)</s><s class='punctuation section class begin python'>:</s></s>
</span><span class='l l-23 source python'><s class='meta function python'>    <s class='storage type function python'>def</s> <s class='entity name function python'>runCommand</s><s class='punctuation definition parameters begin python'>(</s><s class='meta function parameters python'><s class='variable parameter function python'>self</s><s class='punctuation separator parameters python'>,</s> <s class='variable parameter function python'>edit</s></s><s class='punctuation definition parameters end python'>)</s><s class='punctuation section function begin python'>:</s></s>
</span><span class='l l-24 source python'>        <s class='keyword control flow python'>for</s> region <s class='keyword operator logical python'>in</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>:
</span><span class='l l-25 source python'>            line <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.line<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>region</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-26 source python'>            line_contents <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>rstrip<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-27 source python'>            has_bullet <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>re.match<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>^(\s*)[<s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta function-call python'>re.escape<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='variable language python'>self</s>.open_tasks_bullet</s><s class='punctuation definition arguments end python'>)</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta function-call python'>re.escape<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='variable language python'>self</s>.done_tasks_bullet</s><s class='punctuation definition arguments end python'>)</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>]<s class='punctuation definition string end python'>'</s></s>, <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-28 source python'>            current_scope <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.scope_name<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s><s class='meta item-access python'><s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s><s class='punctuation definition arguments end python'>]</s></s>.b</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-29 source python'>            <s class='keyword control flow python'>if</s> has_bullet:
</span><span class='l l-30 source python'>                grps <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>has_bullet.groups<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-31 source python'>                line_contents <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s><s class='constant character escape linefeed python'>\n</s><s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta item-access python'>grps<s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s>]</s> <s class='keyword operator arithmetic python'>+</s> <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s>
</span><span class='l l-32 source python'>                <s class='meta function-call python'><s class='variable language python'>self</s>.view.replace<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>edit, line, line_contents</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-33 source python'>            <s class='keyword control flow python'>elif</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>header<s class='punctuation definition string end python'>'</s></s> <s class='keyword operator logical python'>in</s> current_scope:
</span><span class='l l-34 source python'>                header <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>re.match<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>^(\s*)\S+<s class='punctuation definition string end python'>'</s></s>, <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-35 source python'>                <s class='keyword control flow python'>if</s> header:
</span><span class='l l-36 source python'>                    grps <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>header.groups<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-37 source python'>                    line_contents <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s><s class='constant character escape linefeed python'>\n</s><s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta item-access python'>grps<s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s>]</s> <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s>
</span><span class='l l-38 source python'>                <s class='keyword control flow python'>else</s>:
</span><span class='l l-39 source python'>                    line_contents <s class='keyword operator assignment python'>=</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s>
</span><span class='l l-40 source python'>                <s class='meta function-call python'><s class='variable language python'>self</s>.view.replace<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>edit, line, line_contents</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-41 source python'>                end <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s><s class='meta item-access python'><s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s><s class='punctuation definition arguments end python'>]</s></s>.b
</span><span class='l l-42 source python'>                pt <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>sublime.Region<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>end, end</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-43 source python'>                <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>clear<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-44 source python'>                <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>add<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>pt</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-45 source python'>            <s class='keyword control flow python'>else</s>:
</span><span class='l l-46 source python'>                has_space <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>re.match<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'><s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s>^(\s+)(.*)<s class='punctuation definition string end python'>'</s></s>, <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-47 source python'>                <s class='keyword control flow python'>if</s> has_space:
</span><span class='l l-48 source python'>                    grps <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>has_space.groups<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-49 source python'>                    spaces <s class='keyword operator assignment python'>=</s> <s class='meta item-access python'>grps<s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s>]</s>
</span><span class='l l-50 source python'>                    line_contents <s class='keyword operator assignment python'>=</s> spaces <s class='keyword operator arithmetic python'>+</s> <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta item-access python'>grps<s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>1</s></s>]</s>
</span><span class='l l-51 source python'>                    <s class='meta function-call python'><s class='variable language python'>self</s>.view.replace<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>edit, line, line_contents</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-52 source python'>                <s class='keyword control flow python'>else</s>:
</span><span class='l l-53 source python'>                    line_contents <s class='keyword operator assignment python'>=</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='variable language python'>self</s>.open_tasks_bullet <s class='keyword operator arithmetic python'>+</s> <s class='string quoted single single-line python'><s class='punctuation definition string begin python'>'</s> <s class='punctuation definition string end python'>'</s></s> <s class='keyword operator arithmetic python'>+</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.substr<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>line</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-54 source python'>                    <s class='meta function-call python'><s class='variable language python'>self</s>.view.replace<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>edit, line, line_contents</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-55 source python'>                    end <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s><s class='meta item-access python'><s class='punctuation definition arguments begin python'>[</s><s class='meta item-access arguments python'><s class='constant numeric integer decimal python'>0</s></s><s class='punctuation definition arguments end python'>]</s></s>.b
</span><span class='l l-56 source python'>                    pt <s class='keyword operator assignment python'>=</s> <s class='meta function-call python'>sublime.Region<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>end, end</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-57 source python'>                    <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>clear<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-58 source python'>                    <s class='meta function-call python'><s class='variable language python'>self</s>.view.sel<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'></s><s class='punctuation definition arguments end python'>)</s></s>.<s class='meta function-call python'>add<s class='punctuation definition arguments begin python'>(</s><s class='meta function-call arguments python'>pt</s><s class='punctuation definition arguments end python'>)</s></s>
</span><span class='l l-59 source python'>
</span><span class='l l-60 source python'>
</span><span class='l l-61 source python'>
</span><span class='l l-62 source python'>
</span><span class='l l-63 source python'>
</span><span class='l l-64 source python'>
</span><span class='l l-65 source python'>
</span><span class='l l-66 source python'>
</span><span class='l l-67 source python'>
</span><span class='l l-68 source python'>
</span><span class='l l-69 source python'>
</span>
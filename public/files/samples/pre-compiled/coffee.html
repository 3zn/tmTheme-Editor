<span class='l l-1 source coffee'>Application<s class='meta delimiter method period coffee'>.</s>directive <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>scopeBar<s class='punctuation definition string end coffee'>"</s></s><s class='meta delimiter object comma coffee'>, </s><s class='meta brace square coffee'>[</s><s class='meta brace square coffee'>]</s><s class='meta delimiter object comma coffee'>, </s><s class='keyword operator coffee'>-</s><s class='keyword operator coffee'>></s>
</span><span class='l l-2 source coffee'>  <s class='variable assignment coffee'><s class='variable assignment coffee'>replace<s class='punctuation separator key-value'>:</s></s></s> <s class='constant language boolean true coffee'>true</s>
</span><span class='l l-3 source coffee'>  <s class='variable assignment coffee'><s class='variable assignment coffee'>templateUrl<s class='punctuation separator key-value'>:</s></s></s> <s class='string quoted single coffee'><s class='punctuation definition string begin coffee'>'</s>partials/scope_bar<s class='punctuation definition string end coffee'>'</s></s>
</span><span class='l l-4 source coffee'>
</span><span class='l l-5 source coffee'><s class='meta function coffee'>  <s class='entity name function coffee'>link</s></s><s class='keyword operator coffee'>:</s> <s class='meta inline function coffee'><s class='variable parameter function coffee'>(scope, element, attr)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-6 source coffee'>    <s class='variable assignment coffee'><s class='variable assignment coffee'>preview <s class='keyword operator coffee'>=</s></s></s> element<s class='meta delimiter method period coffee'>.</s>prev<s class='meta brace round coffee'>(</s><s class='meta brace round coffee'>)</s>
</span><span class='l l-7 source coffee'>    preview<s class='meta delimiter method period coffee'>.</s>bind <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>mouseover<s class='punctuation definition string end coffee'>"</s></s><s class='meta delimiter object comma coffee'>, </s><s class='meta inline function coffee'><s class='variable parameter function coffee'>(event)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-8 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>active <s class='keyword operator coffee'>=</s></s></s> <s class='meta brace curly coffee'>{</s><s class='meta brace curly coffee'>}</s>
</span><span class='l l-9 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>active.scope <s class='keyword operator coffee'>=</s></s></s> event<s class='meta delimiter method period coffee'>.</s>target<s class='meta delimiter method period coffee'>.</s>dataset<s class='meta delimiter method period coffee'>.</s>entityScope
</span><span class='l l-10 source coffee'>
</span><span class='l l-11 source coffee'>      <s class='keyword control coffee'>if</s> active<s class='meta delimiter method period coffee'>.</s>scope
</span><span class='l l-12 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>active_scope_rule <s class='keyword operator coffee'>=</s></s></s> getScopeSettings<s class='meta brace round coffee'>(</s>active<s class='meta delimiter method period coffee'>.</s>scope<s class='meta brace round coffee'>)</s>
</span><span class='l l-13 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>active.name <s class='keyword operator coffee'>=</s></s></s> active_scope_rule<s class='meta delimiter method period coffee'>.</s>name <s class='keyword control coffee'>if</s> active_scope_rule
</span><span class='l l-14 source coffee'>
</span><span class='l l-15 source coffee'>      scope<s class='meta delimiter method period coffee'>.</s>$apply <s class='keyword operator coffee'>-</s><s class='keyword operator coffee'>></s>
</span><span class='l l-16 source coffee'>        <s class='comment line coffee'><s class='punctuation definition comment coffee'>#</s> Highlight in sidebar
</s></span><span class='l l-17 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>scope.$parent.hovered_rule <s class='keyword operator coffee'>=</s></s></s> active_scope_rule
</span><span class='l l-18 source coffee'>
</span><span class='l l-19 source coffee'>    preview<s class='meta delimiter method period coffee'>.</s>bind <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>mouseout<s class='punctuation definition string end coffee'>"</s></s><s class='meta delimiter object comma coffee'>, </s><s class='meta inline function coffee'><s class='variable parameter function coffee'>(event)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-20 source coffee'>      <s class='comment line coffee'><s class='punctuation definition comment coffee'>#</s> Unhighlight in sidebar
</s></span><span class='l l-21 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>scope.$parent.hovered_rule <s class='keyword operator coffee'>=</s></s></s> <s class='constant language null coffee'>null</s>
</span><span class='l l-22 source coffee'>
</span><span class='l l-23 source coffee'>    preview<s class='meta delimiter method period coffee'>.</s>bind <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>dblclick<s class='punctuation definition string end coffee'>"</s></s><s class='meta delimiter object comma coffee'>, </s><s class='meta inline function coffee'><s class='variable parameter function coffee'>(event)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-24 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>active <s class='keyword operator coffee'>=</s></s></s> <s class='meta brace curly coffee'>{</s><s class='meta brace curly coffee'>}</s>
</span><span class='l l-25 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>active.scope <s class='keyword operator coffee'>=</s></s></s> event<s class='meta delimiter method period coffee'>.</s>target<s class='meta delimiter method period coffee'>.</s>dataset<s class='meta delimiter method period coffee'>.</s>entityScope
</span><span class='l l-26 source coffee'>
</span><span class='l l-27 source coffee'>      <s class='keyword control coffee'>if</s> active<s class='meta delimiter method period coffee'>.</s>scope
</span><span class='l l-28 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>active_scope_rule <s class='keyword operator coffee'>=</s></s></s> getScopeSettings<s class='meta brace round coffee'>(</s>active<s class='meta delimiter method period coffee'>.</s>scope<s class='meta brace round coffee'>)</s>
</span><span class='l l-29 source coffee'>        showPopover active_scope_rule<s class='meta delimiter object comma coffee'>, </s>event
</span><span class='l l-30 source coffee'>
</span><span class='l l-31 source coffee'>
</span><span class='l l-32 source coffee'>
</span><span class='l l-33 source coffee'><s class='meta function coffee'>    <s class='entity name function coffee'>showPopover </s></s><s class='keyword operator coffee'>=</s> <s class='meta inline function coffee'><s class='variable parameter function coffee'>(rule, event)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-34 source coffee'>      scope<s class='meta delimiter method period coffee'>.</s>$apply <s class='keyword operator coffee'>-</s><s class='keyword operator coffee'>></s>
</span><span class='l l-35 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>scope.$parent.new_popover_visible <s class='keyword operator coffee'>=</s></s></s> <s class='constant language boolean false coffee'>false</s>
</span><span class='l l-36 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>scope.$parent.popover_rule <s class='keyword operator coffee'>=</s></s></s> rule
</span><span class='l l-37 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>scope.$parent.edit_popover_visible <s class='keyword operator coffee'>=</s></s></s> <s class='constant language boolean true coffee'>true</s>
</span><span class='l l-38 source coffee'>
</span><span class='l l-39 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>popover <s class='keyword operator coffee'>=</s></s></s> $<s class='meta brace round coffee'>(</s><s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>#edit-popover<s class='punctuation definition string end coffee'>"</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-40 source coffee'>
</span><span class='l l-41 source coffee'>      <s class='keyword control coffee'>if</s> popover<s class='meta delimiter method period coffee'>.</s><s class='keyword operator coffee'>is</s><s class='meta brace round coffee'>(</s><s class='string quoted single coffee'><s class='punctuation definition string begin coffee'>'</s>.slide<s class='punctuation definition string end coffee'>'</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-42 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>left_offset <s class='keyword operator coffee'>=</s></s></s> $<s class='meta brace round coffee'>(</s><s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>#gallery<s class='punctuation definition string end coffee'>"</s></s><s class='meta brace round coffee'>)</s><s class='meta delimiter method period coffee'>.</s>width<s class='meta brace round coffee'>(</s><s class='meta brace round coffee'>)</s>
</span><span class='l l-43 source coffee'>      <s class='keyword control coffee'>else</s>
</span><span class='l l-44 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>left_offset <s class='keyword operator coffee'>=</s></s></s> <s class='constant numeric coffee'>0</s>
</span><span class='l l-45 source coffee'>
</span><span class='l l-46 source coffee'>      <s class='variable assignment coffee'><s class='variable assignment coffee'>offset <s class='keyword operator coffee'>=</s></s></s>
</span><span class='l l-47 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>left<s class='punctuation separator key-value'>:</s></s></s> <s class='meta brace round coffee'>(</s>popover<s class='meta delimiter method period coffee'>.</s>width<s class='meta brace round coffee'>(</s><s class='meta brace round coffee'>)</s> <s class='keyword operator coffee'>/</s> <s class='constant numeric coffee'>2</s><s class='meta brace round coffee'>)</s> <s class='keyword operator coffee'>+</s> <s class='constant numeric coffee'>10</s> <s class='keyword operator coffee'>+</s> left_offset
</span><span class='l l-48 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>top<s class='punctuation separator key-value'>:</s></s></s> <s class='constant numeric coffee'>24</s>
</span><span class='l l-49 source coffee'>
</span><span class='l l-50 source coffee'>      popover<s class='meta delimiter method period coffee'>.</s>css<s class='meta brace round coffee'>(</s><s class='meta brace curly coffee'>{</s>
</span><span class='l l-51 source coffee'>        <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>left<s class='punctuation definition string end coffee'>"</s></s><s class='keyword operator coffee'>:</s> event<s class='meta delimiter method period coffee'>.</s>pageX <s class='keyword operator coffee'>-</s> offset<s class='meta delimiter method period coffee'>.</s>left
</span><span class='l l-52 source coffee'>        <s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>top<s class='punctuation definition string end coffee'>"</s></s><s class='keyword operator coffee'>:</s> event<s class='meta delimiter method period coffee'>.</s>pageY <s class='keyword operator coffee'>+</s> offset<s class='meta delimiter method period coffee'>.</s>top
</span><span class='l l-53 source coffee'>      <s class='meta brace curly coffee'>}</s><s class='meta brace round coffee'>)</s><s class='meta delimiter method period coffee'>.</s>addClass<s class='meta brace round coffee'>(</s><s class='string quoted double coffee'><s class='punctuation definition string begin coffee'>"</s>on-bottom<s class='punctuation definition string end coffee'>"</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-54 source coffee'>
</span><span class='l l-55 source coffee'>
</span><span class='l l-56 source coffee'><s class='meta function coffee'>    <s class='entity name function coffee'>getScopeSettings </s></s><s class='keyword operator coffee'>=</s> <s class='meta inline function coffee'><s class='variable parameter function coffee'>(active_scope)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-57 source coffee'>      <s class='keyword control coffee'>return</s> <s class='keyword control coffee'>unless</s> scope<s class='meta delimiter method period coffee'>.</s>$parent<s class='meta delimiter method period coffee'>.</s>jsonTheme<s class='meta delimiter method period coffee'>.</s>settings
</span><span class='l l-58 source coffee'>
</span><span class='l l-59 source coffee'>      <s class='keyword control coffee'>return</s> scope<s class='meta delimiter method period coffee'>.</s>$parent<s class='meta delimiter method period coffee'>.</s>jsonTheme<s class='meta delimiter method period coffee'>.</s>settings<s class='meta delimiter method period coffee'>.</s>find <s class='meta inline function coffee'><s class='variable parameter function coffee'>(item)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-60 source coffee'>        <s class='keyword control coffee'>return</s> <s class='keyword control coffee'>unless</s> item<s class='meta delimiter method period coffee'>.</s>scope
</span><span class='l l-61 source coffee'>
</span><span class='l l-62 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>item_scopes <s class='keyword operator coffee'>=</s></s></s> item<s class='meta delimiter method period coffee'>.</s>scope<s class='meta delimiter method period coffee'>.</s>split<s class='meta brace round coffee'>(</s><s class='string quoted single coffee'><s class='punctuation definition string begin coffee'>'</s>, <s class='punctuation definition string end coffee'>'</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-63 source coffee'>
</span><span class='l l-64 source coffee'>        <s class='variable assignment coffee'><s class='variable assignment coffee'>match <s class='keyword operator coffee'>=</s></s></s> item_scopes<s class='meta delimiter method period coffee'>.</s>filter <s class='meta inline function coffee'><s class='variable parameter function coffee'>(item_scope)</s> <s class='storage type function coffee'>-></s></s>
</span><span class='l l-65 source coffee'>          <s class='variable assignment coffee'><s class='variable assignment coffee'>item_scopes_arr <s class='keyword operator coffee'>=</s></s></s> item_scope<s class='meta delimiter method period coffee'>.</s>split<s class='meta brace round coffee'>(</s><s class='string quoted single coffee'><s class='punctuation definition string begin coffee'>'</s>.<s class='punctuation definition string end coffee'>'</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-66 source coffee'>          <s class='variable assignment coffee'><s class='variable assignment coffee'>active_scope_arr <s class='keyword operator coffee'>=</s></s></s> active_scope<s class='meta delimiter method period coffee'>.</s>split<s class='meta brace round coffee'>(</s><s class='string quoted single coffee'><s class='punctuation definition string begin coffee'>'</s>.<s class='punctuation definition string end coffee'>'</s></s><s class='meta brace round coffee'>)</s>
</span><span class='l l-67 source coffee'>
</span><span class='l l-68 source coffee'>          <s class='keyword control coffee'>return</s> <s class='meta brace round coffee'>(</s>item_scopes_arr<s class='meta delimiter method period coffee'>.</s>subtract active_scope_arr<s class='meta brace round coffee'>)</s><s class='meta delimiter method period coffee'>.</s>length <s class='keyword operator coffee'><</s> <s class='constant numeric coffee'>1</s>
</span><span class='l l-69 source coffee'>
</span><span class='l l-70 source coffee'>        <s class='keyword control coffee'>return</s> item <s class='keyword control coffee'>if</s> match<s class='meta delimiter method period coffee'>.</s>length
</span>
